# Save this file in: gateway/nginx.conf

server {
    listen 80;

    # Allow requests from our frontend development server
    location / {
        # This is a standard CORS header setup to allow our React app to talk to the gateway
        add_header 'Access-Control-Allow-Origin' 'http://localhost:5173';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
        
        if ($request_method = 'OPTIONS') {
            return 204;
        }

        # Route for the Reflector Agent
        location /api/reflector {
            proxy_pass http://reflector-agent/analyze;
        }

        # Route for the Strategist Agent
        location /api/strategist {
            proxy_pass http://strategist-agent/analyze;
        }

        # Route for the Music Agent
        location /api/music {
            proxy_pass http://music-agent/analyze;
        }

        # Route for the final Challenger Agent
        location /api/challenger {
            proxy_pass http://challenger-agent/synthesize;
        }
    }
}